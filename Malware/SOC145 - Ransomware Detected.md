# SOC Alert Investigation

## 1. Alert Overview

- **Platform:** LetsDefend SOC Environment
- **Alert Name / ID:** SOC145 - Ransomware Detected
- **Event ID:** 92
- **Category:** Malware
- **Severity:** Critical
- **Date & Time:** May, 23, 2021, 07:32 PM
- **MITRE ATT&CK (if applicable):**
  - [T1204 - User Execution](https://attack.mitre.org/techniques/T1204/)
  - [T1486 - Data Encrypted for Impact](https://attack.mitre.org/techniques/T1486/)

**Description:**  
This alert was generated after the ransomware binary `ab.exe` was detected on host `MarkPRD` (`172.16.17.88`). The endpoint security action was **Allowed** (not automatically quarantined), so the file was likely present and/or executed on the host. Static and dynamic analysis confirm the file is **Avaddon/Delshad ransomware**, capable of encrypting local files and dropping a ransom note.

---

## 2. Initial Analysis

- Attacker IP: N/A (not provided in alert)
- Host IP: 172.16.17.88
- Hostname / User: MarkPRD
- Relevant Logs / Indicators:
  - File Name: ab.exe
  - File Hash (MD5): 0b486fe0503524cfe4726a4022fa6a68
  - File Hash (SHA256): 1228d0f04f0ba82569fc1c0609f9fd6c377a91b9ea44c1e7f9f84b2b90552da2
  - File Size: 775.50 Kb
  - Device Action: Allowed
  - Download (Password: `infected`): https://files-ld.s3.us-east-2.amazonaws.com/0b486fe0503524cfe4726a4022fa6a68.zip

---

## 3. Investigation Steps

- **Step 1 - Alert Triage:**
  Confirmed this is a **Critical** malware alert (ransomware) tied to `MarkPRD` (`172.16.17.88`) and the suspicious binary `ab.exe`. Since the device action was **Allowed**, proceeded assuming the host may already be impacted.

- **Step 2 - Playbook / Threat Indicator Selection:**
  Reviewed available logs for abnormal outbound traffic / C2. No relevant network logs were observed in the investigation, and the endpoint telemetry was limited (EDR indicated no agent/log ingestion for deeper host events). Selected **Other** for threat indicators.

- **Step 3 - Endpoint Containment Check:**
  Verified the file/host was **not quarantined**. Recommended/initiated isolation (quarantine) from endpoint management to prevent further encryption or lateral movement.

- **Step 4 - Static Analysis (Threat Intelligence):**
  Submitted the hash to threat intel sources. VirusTotal results show high-confidence malicious detections and classify the sample as **ransomware** (commonly labeled **Avaddon/Delshad** by vendors).

- **Step 5 - Dynamic Analysis (Sandbox):**
  Executed the sample in a sandbox (Any.Run). The sample exhibits ransomware behavior: file encryption (new extension observed: `bbdabdeEdE`) and a ransom note referencing a Tor onion site (`avaddongun7rngel.onion`). No clear C2 communication was observed during sandbox execution.

- **Step 6 - Scope Check / Hunting (Environment):**
  Searched for additional occurrences of:
  - `ab.exe`
  - MD5 `0b486fe0503524cfe4726a4022fa6a68`
    No other impacted hosts were identified in this investigation.

---

## 4. Findings & Evidence

- VirusTotal Scan: https://www.virustotal.com/gui/file/1228d0f04f0ba82569fc1c0609f9fd6c377a91b9ea44c1e7f9f84b2b90552da2
- Any Run Scan: https://app.any.run/tasks/cddd3f4a-d2ff-415b-a004-5f52d54dffa0
- Confirmed ransomware behaviors in sandbox:
  - Encryption of user files (extension observed: `bbdabdeEdE`)
  - Ransom note dropped on disk referencing Tor site `avaddongun7rngel.onion`
- Network evidence:
  - No relevant outbound/C2 logs identified during the investigation (limited endpoint telemetry in this scenario).

---

## 5. Incident Classification

- **Final Verdict:** True Positive
- **Attack Stage:** Execution / Impact
- **Attack Vector:** Malicious file download and execution (`ab.exe`)
- **Malware Type:** Ransomware
- **Impact:** Host-level file encryption on `MarkPRD` (`172.16.17.88`) with potential business disruption and data loss risk.

---

## 6. Response & Mitigation

- **Immediate Containment:**
  Quarantine/isolate `MarkPRD` from the network to stop additional encryption activity and reduce lateral movement risk.

- **Indicator Blocking:**
  Block the following indicators in endpoint and perimeter controls:
  - MD5: `0b486fe0503524cfe4726a4022fa6a68`
  - SHA256: `1228d0f04f0ba82569fc1c0609f9fd6c377a91b9ea44c1e7f9f84b2b90552da2`
  - File name: `ab.exe`

- **Credential Reset:**
  Reset credentials for any user accounts that authenticated to `MarkPRD` during the suspected window (user not provided in the alert) and rotate any local admin credentials if applicable.

- **Malware Removal & Host Remediation:**
  Remove `ab.exe` and any associated artifacts, then reimage or restore the system from known-good backups. Validate backup integrity and ensure VSS/backups are protected (ransomware frequently targets shadow copies).

- **Threat Hunt:**
  Hunt across the environment for:
  - File name `ab.exe`
  - Hashes above (MD5/SHA256)
  - File extension `bbdabdeEdE`
  - Ransom note indicators (text referencing `avaddongun7rngel.onion`)

- **IOC Sharing:**
  Share extracted indicators and analysis results with the SOC team and update detection content (blocklists / YARA rules / EDR policy) to prevent recurrence.

---

## 7. Lessons Learned

- Critical malware alerts should default to **automatic containment** (quarantine/isolate) when the endpoint action is "Allowed".
- Limited endpoint telemetry (no EDR agent/log ingestion) slows investigations; ensure agent coverage on all endpoints.
- Combining threat intel (VirusTotal) with sandboxing (Any.Run) quickly validates ransomware behavior and supports confident classification.

---

## Indicators of Compromise (IOCs)

| Type             | Value                                                              |
| ---------------- | ------------------------------------------------------------------ |
| Sender Email     | N/A                                                                |
| Sender Domain    | files-ld.s3.us-east-2.amazonaws.com (malware download source)      |
| SMTP Relay IP    | N/A                                                                |
| C2 IP            | N/A (not observed)                                                 |
| C2 Port          | N/A                                                                |
| Attachment Name  | `0b486fe0503524cfe4726a4022fa6a68.zip` (password: `infected`)      |
| Malware Name     | `ab.exe`                                                           |
| SHA256 Hash      | `1228d0f04f0ba82569fc1c0609f9fd6c377a91b9ea44c1e7f9f84b2b90552da2` |
| Malware Family   | Avaddon/Delshad (per threat intel vendor labels)                   |
| Mutex            | N/A                                                                |
| Persistence Path | N/A (not observed)                                                 |
| Victim Host IP   | 172.16.17.88                                                       |
| Victim User      | N/A (not provided in alert)                                        |

---

## Notes

- Environment: Simulated SOC / Lab Environment
- This investigation was conducted for learning and skill development purposes.
